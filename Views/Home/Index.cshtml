<ul>
    @foreach (var file in Model)
    {
        <li>
            @file
            <button onclick="openFlip('@file')">Xem</button>
        </li>
    }
</ul>

<div id="flipbookContainer" style="height:650px"></div>
<script>
    function openFlip(filename) {
        fetch(`/viewer/${encodeURIComponent(filename)}`)
            .then(res => {
                if (!res.ok) throw new Error("Server error");
                return res.json();
            })
            .then(data => {
                if (!data.url) {
                    alert("Không tạo được PDF");
                    return;
                }

                const container = document.getElementById("flipbookContainer");
                container.innerHTML = "";

                container.innerHTML = `
                    <div class="_df_book"
                         height="650"
                         webgl="true"
                         backgroundcolor="#f5f5f5"
                         source="${data.url}">
                    </div>
                `;

                // 🔥 BẮT BUỘC – nếu thiếu dòng này thì dFlip KHÔNG chạy
                if (window.DFLIP && DFLIP.parseBooks) {
                    DFLIP.parseBooks();
                }
            })
            .catch(err => {
                console.error(err);
                alert("Lỗi khi mở tài liệu");
            });
    }
</script>
